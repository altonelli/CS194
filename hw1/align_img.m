function F = align_img(T, B);C = normxcorr2(T(:,:,1),B(:,:,1));%figure, surf(C), shading flat;% offset found by correlationq[max_C, imax] = max(abs(C(:)));[ypeak, xpeak] = ind2sub(size(C), imax(1));corr_offset = [(xpeak-size(T,2)) (ypeak-size(T,1))];% relative offset of position of subimagesrect_offset = [(B(1)-T(1)) (B(2)-T(2))]           % total offsetoffset = corr_offset + rect_offset;xoffset = round(offset(1))yoffset = round(offset(2))F = circshift(T,[xoffset yoffset]);end